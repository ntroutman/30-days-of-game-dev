<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Day 4: Create a Key Item and Use it to Open a Door | 30 Days of Gamed Dev</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Day 4: Create a Key Item and Use it to Open a Door" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="After following the guide from Day 3.5 I thought this should be a piece of cake." />
<meta property="og:description" content="After following the guide from Day 3.5 I thought this should be a piece of cake." />
<meta property="og:site_name" content="30 Days of Gamed Dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-09T16:00:00-08:00" />
<script type="application/ld+json">
{"description":"After following the guide from Day 3.5 I thought this should be a piece of cake.","headline":"Day 4: Create a Key Item and Use it to Open a Door","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/30-days-of-game-dev/2019/11/09/day4.html"},"url":"/30-days-of-game-dev/2019/11/09/day4.html","dateModified":"2019-11-09T16:00:00-08:00","datePublished":"2019-11-09T16:00:00-08:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/30-days-of-game-dev/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/30-days-of-game-dev/feed.xml" title="30 Days of Gamed Dev" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/30-days-of-game-dev/">30 Days of Gamed Dev</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Day 4: Create a Key Item and Use it to Open a Door</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-11-09T16:00:00-08:00" itemprop="datePublished">Nov 9, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>After following the guide from Day 3.5 I thought this should be a piece of cake.</p>

<ol>
  <li>Create a new child class of BP_BaseInteractable called “BP_Door”</li>
  <li>Add a function “ShouldOpen?” which returns a single boolean defaulting to “True”, this method would allow arbitrary conditions for child classes, such as keys.</li>
  <li>Make a new child class of BP_Door called “BP_KeyCard_Door” which has a variable of type “BP_BaseItem” that will be the key card that has to be in the player’s inventory in order for the door to open.</li>
  <li>Override “ShouldOpen?” in BP_KeyCard_Door to check the player’s inventory for the needed key card.</li>
  <li>Done!</li>
</ol>

<p>This ended up take several hours due to a whole slew of reasons.</p>

<h3 id="the-door">The Door</h3>

<p>Lets start with the door. I redid the door from Day 2 to make a sliding door instead of a rotating door. The door blueprint also contains a “Should Open?” method which returns true/false if the door determines it can be opened or not. It also has a “Should Close?” that behaves the same for closing.</p>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BP_Door.jpg" />
  <figcaption>
The event graph for BP_Door, shows calling 'Should Open?' to determine if the door will respond</figcaption>
</figure>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BP_Door_ShouldOpen.jpg" alt="BP_Door Blueprint - Should Open" />
  <figcaption>
Default implementation of Should Open? for BP_Door, always 'True'.</figcaption>
</figure>

<h3 id="inventory-checking">Inventory Checking</h3>

<p>Initially I had written the key card door’s “Should Open” method by simply casting the instigator of the interaction to MyCharacter, grabbing the Inventory array and checking if if contained the ItemInfo of the referenced Key actor. Apparently, checking if a struct is in an array of structs is kind of broken. I couldn’t get it to work. After a lot of futzing around I ended up decided to re-architect my code a bit. This included two things, adding an “ItemId” to ItemInfo and adding a new “Inventory” blueprint component.</p>

<h3 id="a-new-inventory-component">A New Inventory Component</h3>

<p>Instead of burying the inventory as a variable inside of the character class and filling that class up with inventory specific methods, I decided to create a new Actor Component called “BPC_Inventory” which would hold the whole inventory subsystem for tracking what is in an inventory, checking the contents, stacking, checking if there is room, etc. This meant that when the “Pickup” event was called on the character it simply called “Add Item” on the attached inventory component.</p>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BP_BaseItem_Interact.png" alt="Blueprint: BP_BaseItem: Interact" />
  <figcaption>
Interacting with a BaseItem calls 'Pickup' on the character.</figcaption>
</figure>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/MyCharacter_Pickup.png" alt="Blueprint: MyCharacter: Pickup" />
  <figcaption>
*"Add Item" is called on the Inventory when the player picks up an item. Note, the item is only destroyed if it was successfully picked up and added to the inventory.</figcaption>
</figure>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BPC_Inventory_AddItem.png" alt="Blueprint: BPC_Inventory: Add Item" />
  <figcaption>
*The inventory attempts to add the requested item to the inventory if there is room, it returns a success/fail depending on if it was successfully added.</figcaption>
</figure>

<p>This also meant that the Key Card door didn’t need to know how to check the player’s inventory instead it got the Inventory Component from the character and calls “Contains Item?” with the key card ItemInfo. Inside of the “Contains Item?” function on the inventory it would iterate over all the items and check if the requested item’s ItemId matched any item, if so then return “True”, or “False” otherwise.</p>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BPC_Inventory_ContainsItem.jpg" alt="Blueprint: BPC_Inventory: Contains Item?" />
  <figcaption>
*The "Contains Item?" function checks by ItemId, a Name type variable on ItemInfo</figcaption>
</figure>

<h3 id="the-final-door">The Final Door</h3>

<p>Once the inventory component was up and working, then creating the Key Card door was as easy as expected. Simply create a new BP_KeyCard_Door extending BP_Door and override “Should Open?” to check if a specific item was in the players inventory or not. The Key item is a public Variable on BP_KeyCard_Door pointing to an instance of BP_BaseItem. The only really special thing is that the Key item is an Actor of type BP_BaseItem, but the Inventory Component holds ItemInfo structs, not Actors. This means that on BeginPlay the door pulls out the ItemInfo struct from the Key item for later checking if the player has it in their inventory.</p>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BP_KeyCard_Door_BeginPlay.png" alt="BP_KeyCardDoor_Door Blueprint - Event graph" />
  <figcaption>
*Begin Play extracts the ItemInfo from the key actor and stores it for latter use.</figcaption>
</figure>

<figure class="default-caption"><img src="/30-days-of-game-dev/assets/image/day4/BP_KeyCard_Door_ShouldOpen.jpg" alt="BP_Door Blueprint - Event graph" />
  <figcaption>
*The overridden version of 'Should Open?' that shows the check for the key item info in the players inventory.</figcaption>
</figure>

  </div><a class="u-url" href="/30-days-of-game-dev/2019/11/09/day4.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/30-days-of-game-dev/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">30 Days of Gamed Dev</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">30 Days of Gamed Dev</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ntroutman"><svg class="svg-icon"><use xlink:href="/30-days-of-game-dev/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ntroutman</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"><p>Welcome! Here I am recording my Journey through <a href="https://www.twitch.tv/kindreddev/">KindredDev’s</a>  “<a href="{{site.baseurl}}/assets/image/30Days.png">30 Days of Game Dev</a>” challenge.  You can also follow along with my GitHub repo: <a href="https://github.com/ntroutman/30-days-of-game-dev">https://github.com/ntroutman/30-days-of-game-dev</a></p>
</div>
    </div>

  </div>

</footer>
</body>

</html>
